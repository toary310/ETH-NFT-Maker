// ğŸ› ï¸ Hardhaté–‹ç™ºç’°å¢ƒã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const hre = require("hardhat");
// ğŸ“¦ Ethers.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã¨ã®é€šä¿¡ç”¨ï¼‰
const { ethers } = hre;

/**
 * ğŸš€ Web3Mint NFTã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 *
 * ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å½¹å‰²ã€‘
 * ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Œã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å»ºè¨­ç›£ç£ã€ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚
 * ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«å®‰å…¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€
 * å¿…è¦ãªæƒ…å ±ã‚’åé›†ãƒ»è¡¨ç¤ºã—ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®é€£æºæº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚
 *
 * ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã¯ï¼Ÿã€‘
 * - ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«é…ç½®ã™ã‚‹ã“ã¨
 * - ä¸€åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã¨ã€æ°¸ç¶šçš„ã«ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã«å­˜åœ¨
 * - ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã¯èª°ã§ã‚‚ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨ç›¸äº’ä½œç”¨å¯èƒ½
 * - ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ã‚¬ã‚¹æ–™é‡‘ï¼ˆæ‰‹æ•°æ–™ï¼‰ãŒå¿…è¦
 *
 * ã€ä½¿ç”¨æ–¹æ³•ã€‘
 * ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º: npx hardhat run scripts/deploy.js
 * Sepoliaãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆ: npx hardhat run scripts/deploy.js --network sepolia
 *
 * ã€å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã€‘
 * 1. ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã®ç¢ºèªï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã€æ®‹é«˜ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
 * 2. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
 * 3. ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
 * 4. ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã®ç¢ºèªã¨è¡¨ç¤º
 * 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨è¨­å®šæƒ…å ±ã®å‡ºåŠ›
 * 6. ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å‹•ä½œç¢ºèª
 *
 * ã€åˆå¿ƒè€…å‘ã‘è§£èª¬ã€‘
 * - ã‚¬ã‚¹ = ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ã®å‡¦ç†æ‰‹æ•°æ–™
 * - gwei = ã‚¬ã‚¹ä¾¡æ ¼ã®å˜ä½ï¼ˆ1 ETH = 10^9 gweiï¼‰
 * - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ = ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ã®å–å¼•è¨˜éŒ²
 * - Etherscan = Ethereumãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã®æƒ…å ±ã‚’è¦‹ã‚‹ã‚µã‚¤ãƒˆ
 */
async function main() {
  try {
    // ğŸ ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹ã®æ¡ˆå†…
    console.log("ğŸš€ Web3Mint NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã—ã¾ã™...");

    // ğŸ‘¤ ãƒ‡ãƒ—ãƒ­ã‚¤è€…ï¼ˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’é…ç½®ã™ã‚‹äººï¼‰ã®æƒ…å ±ã‚’å–å¾—
    const [deployer] = await ethers.getSigners();
    const deployerAddress = await deployer.getAddress();
    const deployerBalance = await ethers.provider.getBalance(deployerAddress);

    // ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
    console.log("ğŸ“‹ ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±:");
    console.log(`  ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ãƒ‰ãƒ¬ã‚¹: ${deployerAddress}`);
    console.log(`  æ®‹é«˜: ${ethers.formatEther(deployerBalance)} ETH`);
    console.log(`  ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: ${hre.network.name}`);

    // ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ã‚’å–å¾—
    const network = await ethers.provider.getNetwork();
    console.log(`  ãƒã‚§ãƒ¼ãƒ³ID: ${network.chainId}`);

    // â›½ ã‚¬ã‚¹ä¾¡æ ¼ã‚’å–å¾—ï¼ˆSepoliaãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã®å ´åˆï¼‰
    if (hre.network.name === "sepolia") {
      const gasPrice = await ethers.provider.getFeeData();
      console.log(`  æ¨å®šã‚¬ã‚¹ä¾¡æ ¼: ${ethers.formatUnits(gasPrice.gasPrice, "gwei")} gwei`);
      // ã€ã‚¬ã‚¹ä¾¡æ ¼ã¨ã¯ï¼Ÿã€‘
      // - ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ã®å‡¦ç†æ‰‹æ•°æ–™ã®å˜ä¾¡
      // - é«˜ã„ã»ã©å‡¦ç†ãŒæ—©ãå®Œäº†ã™ã‚‹
      // - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ··é›‘çŠ¶æ³ã«ã‚ˆã£ã¦å¤‰å‹•
    }

    // ğŸ“¦ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«é–‹å§‹
    console.log("\nğŸ“¦ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ä¸­...");

    // ğŸ­ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚’å–å¾—ï¼ˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã€Œè¨­è¨ˆå›³ã€ï¼‰
    const Web3Mint = await ethers.getContractFactory("Web3Mint");

    console.log("â³ Web3Mintã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...");

    // ğŸš€ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«ãƒ‡ãƒ—ãƒ­ã‚¤
    const web3Mint = await Web3Mint.deploy();

    // â° ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Œäº†ã‚’å¾…æ©Ÿï¼ˆãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã§ã®ç¢ºèªã‚’å¾…ã¤ï¼‰
    await web3Mint.waitForDeployment();

    // ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
    const contractAddress = await web3Mint.getAddress();

    console.log("\nâœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†!");
    console.log("ğŸ“‹ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæƒ…å ±:");
    console.log(`  ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹: ${contractAddress}`);
    console.log(`  ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒƒã‚·ãƒ¥: ${web3Mint.deploymentTransaction().hash}`);

    // ğŸ“Š ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®åŸºæœ¬æƒ…å ±ã‚’å–å¾—ãƒ»è¡¨ç¤º
    const name = await web3Mint.name();
    const symbol = await web3Mint.symbol();
    const owner = await web3Mint.owner();
    const mintPrice = await web3Mint.mintPrice();
    const maxSupply = await web3Mint.MAX_SUPPLY();

    console.log("\nğŸ” ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆè©³ç´°:");
    console.log(`  åå‰: ${name}`);
    console.log(`  ã‚·ãƒ³ãƒœãƒ«: ${symbol}`);
    console.log(`  æ‰€æœ‰è€…: ${owner}`);
    console.log(`  ãƒŸãƒ³ãƒˆæ–™é‡‘: ${ethers.formatEther(mintPrice)} ETH`);
    console.log(`  æœ€å¤§ä¾›çµ¦é‡: ${maxSupply}`);

    // ğŸ”— Sepoliaãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã®å ´åˆã€Etherscanãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
    if (hre.network.name === "sepolia") {
      console.log("\nğŸ”— Etherscan ãƒªãƒ³ã‚¯:");
      console.log(`  ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ: https://sepolia.etherscan.io/address/${contractAddress}`);
      console.log(`  ãƒ‡ãƒ—ãƒ­ã‚¤Tx: https://sepolia.etherscan.io/tx/${web3Mint.deploymentTransaction().hash}`);

      // ğŸ“ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæ¤œè¨¼ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤º
      console.log("\nğŸ“ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆèªè¨¼ã‚³ãƒãƒ³ãƒ‰:");
      console.log(`npx hardhat verify --network sepolia ${contractAddress}`);
      // ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆèªè¨¼ã¨ã¯ï¼Ÿã€‘
      // - ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’Etherscanã§å…¬é–‹
      // - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å†…å®¹ã‚’ç¢ºèªã§ãã‚‹
      // - é€æ˜æ€§ã¨ä¿¡é ¼æ€§ã®å‘ä¸Š
    }

    // ğŸ”§ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ç’°å¢ƒå¤‰æ•°ã‚’è¡¨ç¤º
    console.log("\nğŸ”§ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ç’°å¢ƒå¤‰æ•°:");
    console.log(`REACT_APP_CONTRACT_ADDRESS=${contractAddress}`);
    console.log(`REACT_APP_NETWORK_NAME=${hre.network.name}`);
    console.log(`REACT_APP_CHAIN_ID=${network.chainId}`);
    // ã€ã“ã‚Œã‚‰ã®å¤‰æ•°ã®ç”¨é€”ã€‘
    // - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨é€šä¿¡ã™ã‚‹ãŸã‚ã«å¿…è¦
    // - .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¦ä½¿ç”¨
    // - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡ã‚Šæ›¿ãˆæ™‚ã®è‡ªå‹•è¨­å®šã«ä½¿ç”¨

    // ğŸ§ª ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆãƒŸãƒ³ãƒˆå®Ÿè¡Œ
    if (hre.network.name === "hardhat" || hre.network.name === "localhost") {
      console.log("\nğŸ§ª ãƒ†ã‚¹ãƒˆãƒŸãƒ³ãƒˆã‚’å®Ÿè¡Œä¸­...");

      // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿URIã‚’è¨­å®š
      const testTokenURI = "https://example.com/metadata/1.json";
      // æ‰€æœ‰è€…æ¨©é™ã§ãƒ†ã‚¹ãƒˆNFTã‚’ãƒŸãƒ³ãƒˆ
      const mintTx = await web3Mint.ownerMint(deployerAddress, testTokenURI);
      // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å®Œäº†ã‚’å¾…æ©Ÿ
      await mintTx.wait();

      // ãƒŸãƒ³ãƒˆå¾Œã®ç·ä¾›çµ¦é‡ã‚’ç¢ºèª
      const totalSupply = await web3Mint.totalSupply();
      console.log(`âœ… ãƒ†ã‚¹ãƒˆNFTãŒãƒŸãƒ³ãƒˆã•ã‚Œã¾ã—ãŸã€‚ç·ä¾›çµ¦é‡: ${totalSupply}`);
      // ã€ãªãœãƒ†ã‚¹ãƒˆãƒŸãƒ³ãƒˆï¼Ÿã€‘
      // - ãƒ‡ãƒ—ãƒ­ã‚¤ç›´å¾Œã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã‹ç¢ºèª
      // - ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã¿å®Ÿè¡Œï¼ˆæœ¬ç•ªã§ã¯ä¸è¦ï¼‰
      // - é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š
    }

    console.log("\nğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼");

  } catch (error) {
    // âŒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    console.error("\nâŒ ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:");
    console.error(error);
    process.exitCode = 1;  // ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã‚³ãƒ¼ãƒ‰ã‚’1ã«è¨­å®šï¼ˆã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ï¼‰
  }
}

// ğŸš€ ãƒ¡ã‚¤ãƒ³é–¢æ•°ã‚’ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãã§å®Ÿè¡Œ
main().catch((error) => {
  console.error("ğŸ’¥ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼:", error);
  process.exitCode = 1;
});
